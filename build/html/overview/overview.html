

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2. 使用指南综述 &mdash; Knight_doc V3.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=eb26d1a0"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3. 快速上手指南" href="../quick_demo/quick_demo.html" />
    <link rel="prev" title="1. 修改记录" href="../doc_info/doc_info.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Knight_doc
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Knight 工具链</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../doc_info/doc_info.html">1. 修改记录</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. 使用指南综述</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#knight">2.1. Knight介绍</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">2.1.1. 概述</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">2.1.2. 整体框架</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">2.1.3. 开发流程</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ai">2.1.3.1. AI全栈应用开发流程</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">2.1.3.2. 模型资源生成开发流程</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id6">2.1.4. 软件包目录</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">2.1.5. 相关文档</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id8">2.2. 安装部署</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#docker">2.2.1. 准备docker环境</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id9">2.2.1.1. 自动更新安装docker</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ubuntu-16docker">2.2.1.2. Ubuntu 16手动安装docker</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id12">2.2.2. 加载镜像文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">2.2.3. 查看镜像</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">2.2.4. 运行镜像</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id15">2.2.4.1. 镜像用户</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id16">2.2.4.2. 运行命令参数介绍</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id17">2.2.4.3. 运行示例</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id18">2.2.5. 库文件使用说明</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id19">2.3. 支持芯片</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id20">2.4. Knight使用方式</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id21">2.4.1. Knight命令介绍</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id22">2.4.2. 配置文件介绍</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#knight-compare">2.5. Knight compare工具</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id23">2.5.1. 参数说明</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id24">2.5.2. 使用示例</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id25">2.6. 小工具介绍</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#show-sim-result">2.6.1. show_sim_result工具</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id26">2.6.1.1. 参数说明</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id28">2.6.1.2. 使用示例</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#model-modifier">2.6.2. model_modifier工具</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id30">2.6.2.1. 参数说明</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id32">2.6.2.2. 使用示例</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#model-info">2.6.3. model_info工具</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id34">2.6.3.1. 参数说明</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id38">2.6.3.2. 使用示例</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#model-check-py">2.6.4. model_check.py工具</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id40">2.6.4.1. 参数说明</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id42">2.6.4.2. 使用示例</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id44">2.7. 算子介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="#faq">2.8. FAQ</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id45">2.8.1. 退出docker容器后恢复工作环境</a></li>
<li class="toctree-l3"><a class="reference internal" href="#knight-chip">2.8.2. Knight命令行重复输入–chip</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id46">2.8.3. docker权限问题</a></li>
<li class="toctree-l3"><a class="reference internal" href="#knightroot">2.8.4. Knight容器能否使用非root权限启动</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id47">2.8.5. Knight镜像如何增量更新</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id48">2.9. 附录</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quick_demo/quick_demo.html">3. 快速上手指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guides_base/quant.html">4. 量化使用指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guides_base/compile.html">5. 编译仿真性能分析使用指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guides_base/sdk.html">6. SDK使用指南</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">附录</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq/quant_faq.html">1. 量化工具FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../op/op.html">2. 算子支持列表</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Knight_doc</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">2. </span>使用指南综述</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/overview/overview.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1><span class="section-number">2. </span>使用指南综述<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h1>
<p>本文档主要对清微骑士工具链 <code class="docutils literal notranslate"><span class="pre">TS.Knight</span></code> 进行整体介绍，帮助客户建立整体概念，引导客户更好的使用工具链提供的各项功能。同时也提供快速上手的演示方式，方便客户直接运行。</p>
<p><strong>名词解释</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>名词</strong></p></th>
<th class="head"><p><strong>说明</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Knight</p></td>
<td><p>清微骑士工具链英文名称</p></td>
</tr>
<tr class="row-odd"><td><p>QAT</p></td>
<td><p>Quantization Aware
Training，量化感知训练</p></td>
</tr>
<tr class="row-even"><td><p>RNE</p></td>
<td><p>可重构神经网络加速引擎</p></td>
</tr>
<tr class="row-odd"><td><p>RCE</p></td>
<td><p>可重构计算引擎</p></td>
</tr>
<tr class="row-even"><td><p>Finetune</p></td>
<td><p>微调</p></td>
</tr>
<tr class="row-odd"><td><p>IR定点模型</p></td>
<td><p>中间表示模型，指
Caffe定点模型或ONNX定点模型</p></td>
</tr>
</tbody>
</table>
<section id="knight">
<h2><span class="section-number">2.1. </span>Knight介绍<a class="headerlink" href="#knight" title="Permalink to this heading"></a></h2>
<section id="id2">
<h3><span class="section-number">2.1.1. </span>概述<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h3>
<p>TS.Knight是清微智能提供的一站式开发平台，包含部署AI模型所需的全套工具链，支持模型量化、精度比对、模型编译、模拟和性能分析等功能。</p>
</section>
<section id="id3">
<h3><span class="section-number">2.1.2. </span>整体框架<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h3>
<p>TS.Knight整体框架如下图所示：</p>
<figure class="align-center">
<img alt="pipeline" src="../_images/image5.png" />
</figure>
<ul class="simple">
<li><p>Knight压缩工具(Knight-ModelCompression):
用于模型剪枝、稀疏、结构搜索、模型蒸馏等模型压缩。</p></li>
<li><p>Knight量化工具(Knight-Quantize):
基于少量数据(比如图片、语音、文本等类型) 量化浮点模型。</p></li>
<li><p>Knight RNE编译器(Knight-RNE-Compiler):
编译量化模型，产生RNE执行的指令配置文件。</p></li>
<li><p>Knight RNE模拟器(Knight-RNE-Simulator) :
用于仿真神经网络在RNE上推理计算过程，输出计算层的结果。</p></li>
<li><p>Knight RNE性能分析器(Knight-RNE-Profiling):
用于分析神经网络在芯片RNE上执行时间和存储开销，并给出分析报告。</p></li>
<li><p>Knight Finetune库(Knight-Finetune-Lib) :
即QAT库，在使用量化工具后，精度损失较大的情况下，可使用Finetune库进行量化感知训练，得到更适合量化的浮点模型。</p></li>
<li><p>Knight RNE模拟库(Knight-RNE-Simulator-Lib) :
供用户在PC端调用编写自己的应用程序，从而实现模拟运行结果。</p></li>
<li><p>Knight RNE 运行时库(Knight-RNE-Runtime-Lib) :
供用户在PC端交叉编译时调用，从而实现板端运行。</p></li>
<li><p>Knight Demo:
提供计算机视觉，智能语音等领域的端到端的运行示例，演示Knight工具链的使用流程和具体用法。</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>注意：Knight压缩工具、Knight量化工具、Knight RNE编译器、Knight
RNE模拟器和Knight RNE性能分析器所有芯片均支持。</p>
</div>
</section>
<section id="id4">
<h3><span class="section-number">2.1.3. </span>开发流程<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h3>
<section id="ai">
<h4><span class="section-number">2.1.3.1. </span>AI全栈应用开发流程<a class="headerlink" href="#ai" title="Permalink to this heading"></a></h4>
<figure class="align-center">
<img alt="pipeline" src="../_images/image6.png" />
</figure>
<p>Knight工具链可支持端侧AI推理全栈开发，包括应用开发，模型部署资源生成和自定义算子开发三个主要流程。</p>
<p>应用开发：用户调用Knight RNE SDK
API编写自己的业务应用，加载编译后的模型部署资源，链接模拟库在纯软件环境中仿真调试自己的应用，链接板端库在板端进行部署。</p>
<p>模型部署资源生成：用户准备已训练好的浮点模型，使用Knight
量化工具量化成IR定点模型，然后对比量化精度，接着编译生成模型资源，此时用户可进行模拟器结果验证以及Profiling性能调优。</p>
<p>自定义算子开发：当用户模型中存在芯片不支持的算子时，用户在量化后的IR模型中添加自定义算子层，之后进行IR模型编译，供应用开发时调用；用户在应用开发时进行自定义算子的C代码实现，通过SDK
API相应接口进行自定义算子注册。最后，与整个应用程序一起进行模拟库上调测，板端库上部署。</p>
</section>
<section id="id5">
<h4><span class="section-number">2.1.3.2. </span>模型资源生成开发流程<a class="headerlink" href="#id5" title="Permalink to this heading"></a></h4>
<figure class="align-center">
<img alt="pipeline" src="../_images/image71.png" />
</figure>
<ol class="arabic simple">
<li><p>用户使用Knight模型转换工具将提前训练好的浮点模型量化编译成芯片部署资源(.tsmodel)。</p></li>
<li><p>用户使用Knight RNE模拟器对测试数据进行推理，也可以使用Knight
RNE性能分析工具对模型进行性能分析。</p></li>
<li><p>同时用户也可以调用Knight
RNE模拟库编写自己的业务应用在纯软件环境仿真自己的业务模型。</p></li>
<li><p>如果步骤2、3均通过，用户可以调用Knight
RNE运行时库编写自己的实际业务应用，部署到清微芯片上。</p></li>
<li><p>在步骤1中，如果模型推理性能不满足需求，则用户可使用Knight压缩工具将提前训练好的浮点模型进行压缩，得到体积更小，性能更优，更适合端侧部署的浮点模型。（可选）</p></li>
<li><p>在步骤1量化后，如果模型精度损失严重，用户可以使用QAT库，即Knight
Finetune库（当前仅支持pytorch平台）编写自己的Finetune工具对浮点模型进行微调，得到更适合量化的浮点模型，之后再进行步骤1。（可选）</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>注意：在整个开发流程中有如下3个检查点：</p>
<p>1. 用户使用Knight
build工具完成模型转换后，精度比对工具可查看量化后精度是否满足业务要求；</p>
<p>2.
同时model_check工具验证模拟器推理结果和Knight定点模型推理结果一致；</p>
<p>3. 用户使用Knight
RNE运行时库对测试数据进行推理后，需保证其推理结果和Knight
RNE模拟库推理结果一致；</p>
<p>以上3个检查点若不满足预期，可联系清微技术人员进行支持。</p>
</div>
</section>
</section>
<section id="id6">
<h3><span class="section-number">2.1.4. </span>软件包目录<a class="headerlink" href="#id6" title="Permalink to this heading"></a></h3>
<p>Knight产品目录如下所示：</p>
<figure class="align-center">
<img alt="pipeline" src="../_images/image81.png" />
</figure>
<p>ReleaseDocuments目录中为产品文档，示例如下：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>├──<span class="w"> </span>进阶指南
├──<span class="w"> </span>算子规格表
├──<span class="w"> </span><span class="m">01</span>-TS.Knight-使用指南综述_V3.5.pdf
├──<span class="w"> </span><span class="m">02</span>-TS.Knight-快速上手指南_V3.5.pdf
├──<span class="w"> </span><span class="m">03</span>-TS.Knight-模型转换使用指南_V3.5.pd
├──<span class="w"> </span><span class="m">04</span>-TS.Knight-仿真性能分析使用指南_V3.5.pdf
├──<span class="w"> </span><span class="m">05</span>-TS.Knight-SDK使用指南_V3.5.pdf
├──<span class="w"> </span><span class="m">06</span>-TS.Knight-量化工具FAQ_V3.5.pdf
├──<span class="w"> </span><span class="m">07</span>-TS.Knight-SDK-FAQ_V3.5.pdf
├──<span class="w"> </span><span class="m">08</span>-TS.Knight-支持模块清单_V3.5.pdf
</pre></div>
</div>
<p>ReleaseDeliverables目录中为软件产品，示例如下：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>├──<span class="w"> </span>TX510x-Lib
├──<span class="w"> </span>TX5112x_TX5239x201-Lib
├──<span class="w"> </span>TX5215x_TX5239x200_TX5239x220_TX5239x300-Lib
├──<span class="w"> </span>TX5336x_TX5256x-Lib
├──<span class="w"> </span>TX5368x_TX5339x_TX5335x-Lib
├──<span class="w"> </span>TX5326x-Lib
├──<span class="w"> </span>ts.knight-3.5.tar.gz
├──<span class="w"> </span>TS.Knight-MC_3.5.tar.gz
├──<span class="w"> </span>TS-Finetune-Lib_3.5.tar.gz
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<blockquote>
<div><p>注意：以上内容仅为示例，不同版本以实际产品包为准。</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ts.knight-XXX.tar.gz</span></code> 为 <code class="docutils literal notranslate"><span class="pre">Knight</span></code> 镜像压缩包，参见 <a class="reference internal" href="#id14">运行镜像</a> ，运行镜像后进入Knight容器，容器内文件目录如下表所示。</p>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>一级</p></th>
<th class="head"><p>二级目录</p></th>
<th class="head"><p>开源/封闭</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>/TS-KnightSoftware</p></td>
<td><p>/tools</p></td>
<td><p>开源</p></td>
<td><p>常用小工具。/model_check:
检查点2和检查点3结果验证。
详情参见</p>
<blockquote>
<div><p><a href="#id51"><span class="problematic" id="id52">`model_check.py使用说明`_</span></a> 。</p>
</div></blockquote>
</td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>/TS-KnightDemo</p></td>
<td><p>/Resources</p></td>
<td><p>开源</p></td>
<td><p>Knight demo相关的模型和数据，
和代码</p></td>
</tr>
<tr class="row-even"><td><p>/Scripts</p></td>
<td><p>开源</p></td>
<td><p>Knight demo的运行shell脚本</p></td>
</tr>
</tbody>
</table>
<p>Knight库文件目录如下表所示，库相关内容详情参见《TS.Knight-SDK使用指南》</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>一级</p></th>
<th class="head"><p>二级目录</p></th>
<th class="head"><p>开源
封闭</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="2"><p>/TX510x-Lib</p></td>
<td><p>/RNE
-SIM-Lib</p></td>
<td><p>封闭</p></td>
<td><p>TX510x系列芯片 Knight
RNE模拟库，详情参见
<a class="reference internal" href="../user_guides_base/sdk.html"><span class="doc">SDK使用指南</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>/RN
E-RT-Lib</p></td>
<td><p>封闭</p></td>
<td><p>TX510x系列芯片 Knight
RNE运行时库，详情参见
<a class="reference internal" href="../user_guides_base/sdk.html"><span class="doc">SDK使用指南</span></a></p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>/TX5368x_TX5339x_TX53
35x-Lib</p></td>
<td><p>/RNE
-SIM-Lib</p></td>
<td><p>封闭</p></td>
<td><p>TX5368x系列，TX5339x
系列和TX5335x系列芯片Knight
RNE模拟库，详情参见
<a class="reference internal" href="../user_guides_base/sdk.html"><span class="doc">SDK使用指南</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>/RN
E-RT-Lib</p></td>
<td><p>封闭</p></td>
<td><p>TX5368x系列
，TX5339x系列和TX5335x系列
Knight RNE运行时库，详情参见
<a class="reference internal" href="../user_guides_base/sdk.html"><span class="doc">SDK使用指南</span></a></p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>/TX5112x_TX5239x201-L
ib</p></td>
<td><p>/RNE
-SIM-Lib</p></td>
<td><p>封闭</p></td>
<td><p>TX5112x系列和TX5239x201系列芯片
Knight RNE模拟库，详情参见
<a class="reference internal" href="../user_guides_base/sdk.html"><span class="doc">SDK使用指南</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>/RN
E-RT-Lib</p></td>
<td><p>封闭</p></td>
<td><p>TX5112x系列
和TX5239x201系列芯片Knight
RNE运行时库，详情参见
<a class="reference internal" href="../user_guides_base/sdk.html"><span class="doc">SDK使用指南</span></a></p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>/TX5215x_TX5239x200_
TX5239x220_TX5239x300
-Lib</p></td>
<td><p>/RNE-SIM-L
ib</p></td>
<td><p>封闭</p></td>
<td><p>TX5215x系列，TX5
239x200系列，TX5239x220系列
和TX5239x300系列芯片Knight
RNE模拟库,  详情参见
<a class="reference internal" href="../user_guides_base/sdk.html"><span class="doc">SDK使用指南</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>/RN
E-RT-Lib</p></td>
<td><p>封闭</p></td>
<td><p>TX5215x系列,
TX5
239x200系列,TX5239x220系列
和TX5239x300系列芯片Knight
RNE运行时库，详情参见
<a class="reference internal" href="../user_guides_base/sdk.html"><span class="doc">SDK使用指南</span></a></p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>/TX5336x_TX5256x-Lib</p></td>
<td><blockquote>
<div><p>/RNE</p>
</div></blockquote>
<p>-SIM-Lib</p>
</td>
<td><p>封闭</p></td>
<td><p>TX5336系列和TX5256系列芯片Knight
RNE模拟库,  详情参见
<a class="reference internal" href="../user_guides_base/sdk.html"><span class="doc">SDK使用指南</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>/RNE-RT-Li
b</p></td>
<td><p>封闭</p></td>
<td><p>TX5336系列和TX5256系列芯片Knight
RNE运行时库, 详情参见
<a class="reference internal" href="../user_guides_base/sdk.html"><span class="doc">SDK使用指南</span></a></p></td>
</tr>
<tr class="row-even"><td><p>TS.Knight-Fine
tune-Lib_XXX.tar.gz</p></td>
<td></td>
<td><p>开源</p></td>
<td><blockquote>
<div><p>Knight Finetune库,详情参见</p>
</div></blockquote>
<p><span class="xref std std-doc">QAT使用说明</span></p>
</td>
</tr>
<tr class="row-odd"><td><p>TS.Knight-MC_XXX.tar.
gz</p></td>
<td></td>
<td><p>封闭</p></td>
<td><p>Knight压缩工具详情参见
<span class="xref std std-doc">模型压缩使用指南</span></p></td>
</tr>
</tbody>
</table>
</section>
<section id="id7">
<h3><span class="section-number">2.1.5. </span>相关文档<a class="headerlink" href="#id7" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>《TS.Knight-快速上手指南》
《TS.Knight-量化使用指南》
《TS.Knight-量化工具FAQ》
《TS.Knight-编译仿真性能分析使用指南》
《TS.Knight-SDK使用指南》
《TS.Knight-Finetune-Lib使用指南》
《TS.Knight-MC使用指南》
《TS.Knight-xxx-RNE编译器算子规格表》
《TS.Knight-xxx量化算子规格表》
《TS.Knight-转换算子规格表》
《TS.Knight-支持模块清单》</p>
</div></blockquote>
</section>
</section>
<section id="id8">
<h2><span class="section-number">2.2. </span>安装部署<a class="headerlink" href="#id8" title="Permalink to this heading"></a></h2>
<section id="docker">
<h3><span class="section-number">2.2.1. </span>准备docker环境<a class="headerlink" href="#docker" title="Permalink to this heading"></a></h3>
<p>当前Knight支持容器部署的方式，因此需要用户保证已安装docker环境，要求docker版本大于等于19.03，如果已安装则可跳过该章节。</p>
<p>docker安装方式有两种：自动更新安装docker和手动安装docker。</p>
<section id="id9">
<h4><span class="section-number">2.2.1.1. </span>自动更新安装docker<a class="headerlink" href="#id9" title="Permalink to this heading"></a></h4>
<ol class="arabic simple">
<li><p>更新可用软件包列表</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>update
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>更新所有软件包</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>-y<span class="w"> </span>upgrade
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>安装docker</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>docker.io
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>确认docker版本大于等于19.03</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>--version
</pre></div>
</div>
</section>
<section id="ubuntu-16docker">
<h4><span class="section-number">2.2.1.2. </span>Ubuntu 16手动安装docker<a class="headerlink" href="#ubuntu-16docker" title="Permalink to this heading"></a></h4>
<p>Ubuntu 16的默认docker版本是18.x，低于19.03，所以需要手动安装docker。</p>
<section id="id10">
<h5><span class="section-number">2.2.1.2.1. </span>下载docker安装包<a class="headerlink" href="#id10" title="Permalink to this heading"></a></h5>
<ol class="arabic simple">
<li><p>下载url：<a class="reference external" href="https://download.docker.com/linux/ubuntu/dists/">https://download.docker.com/linux/ubuntu/dists/</a></p></li>
</ol>
<p>进入该网址后，进入xenial -&gt; pool -&gt; stable -&gt; amd64</p>
<ol class="arabic simple" start="2">
<li><p>下载安装包：</p></li>
</ol>
<p><a class="reference external" href="https://download.docker.com/linux/ubuntu/dists/xenial/pool/stable/amd64/containerd.io_1.2.13-2_amd64.deb">containerd.io_1.2.13-2_amd64.deb</a></p>
<p><a class="reference external" href="https://download.docker.com/linux/ubuntu/dists/xenial/pool/stable/amd64/docker-ce-cli_19.03.12~3-0~ubuntu-xenial_amd64.deb">docker-ce-cli_19.03.12~3-0~ubuntu-xenial_amd64.deb</a></p>
<p><a class="reference external" href="https://download.docker.com/linux/ubuntu/dists/xenial/pool/stable/amd64/docker-ce_19.03.12~3-0~ubuntu-xenial_amd64.deb">docker-ce_19.03.12~3-0~ubuntu-xenial_amd64.deb</a></p>
</section>
<section id="id11">
<h5><span class="section-number">2.2.1.2.2. </span>安装docker<a class="headerlink" href="#id11" title="Permalink to this heading"></a></h5>
<ol class="arabic simple">
<li><p>更新可用软件包列表</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>update
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>更新所有软件包</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>-y<span class="w"> </span>upgrade
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>安装前面下载的安装包（参考<a class="reference external" href="l">下载docker安装包</a>）</p></li>
</ol>
<blockquote>
<div><p>sudo dpkg -i
<a class="reference external" href="https://download.docker.com/linux/ubuntu/dists/xenial/pool/stable/amd64/containerd.io_1.2.13-2_amd64.deb">containerd.io_1.2.13-2_amd64.deb</a></p>
<p>sudo dpkg -i
<a class="reference external" href="https://download.docker.com/linux/ubuntu/dists/xenial/pool/stable/amd64/docker-ce_19.03.12~3-0~ubuntu-xenial_amd64.deb">docker-ce_19.03.12~3-0~ubuntu-xenial_amd64.deb</a></p>
<p>sudo dpkg -i
<a class="reference external" href="https://download.docker.com/linux/ubuntu/dists/xenial/pool/stable/amd64/docker-ce-cli_19.03.12~3-0~ubuntu-xenial_amd64.deb">docker-ce-cli_19.03.12~3-0~ubuntu-xenial_amd64.deb</a></p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>确认docker版本大于等于19.03</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>-v
</pre></div>
</div>
</section>
</section>
</section>
<section id="id12">
<h3><span class="section-number">2.2.2. </span>加载镜像文件<a class="headerlink" href="#id12" title="Permalink to this heading"></a></h3>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>load<span class="w"> </span>-i<span class="w"> </span>ts.knight-&lt;version&gt;.tar.gz
</pre></div>
</div>
</section>
<section id="id13">
<h3><span class="section-number">2.2.3. </span>查看镜像<a class="headerlink" href="#id13" title="Permalink to this heading"></a></h3>
<p>查看已加载的镜像。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>images
</pre></div>
</div>
<p>页面示例如下所示。</p>
<figure class="align-center">
<img alt="pipeline" src="../_images/image91.png" />
</figure>
</section>
<section id="id14">
<h3><span class="section-number">2.2.4. </span>运行镜像<a class="headerlink" href="#id14" title="Permalink to this heading"></a></h3>
<section id="id15">
<h4><span class="section-number">2.2.4.1. </span>镜像用户<a class="headerlink" href="#id15" title="Permalink to this heading"></a></h4>
<p>docker镜像内默认使用root用户。如果使用非root用户，则需要保证自定义目标路径具有写权限。</p>
</section>
<section id="id16">
<h4><span class="section-number">2.2.4.2. </span>运行命令参数介绍<a class="headerlink" href="#id16" title="Permalink to this heading"></a></h4>
<p>docker run -v &lt;宿主目录&gt;:&lt;docker容器目录&gt; -u 用户名 -it 镜像名称:镜像Tag</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>参
数名
称</strong></p></th>
<th class="head"><p><strong>说明</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-v</p></td>
<td><p>给容器挂载存储卷，挂载到容器的某个目录。</p>
<p>“宿主目录”：本地需映射到容器内的目录（绝对路径）；</p>
<p>“docker容器目录”：docker容器内目录，可以访问宿主机上的文件。</p>
<p>注意：</p>
<p>1）“宿主目录”建议存放用户模型和工具链
输出结果。便于在容器内直接操作，无需进行docker内外文件拷贝。</p>
<p>2）“docker容器目录”不能使用 “/TS-KnightDemo”
和
“/TS-KnightSoftware”，以及其子目录，防止覆盖容器内产品代码。</p>
</td>
</tr>
<tr class="row-odd"><td><p>-u</p></td>
<td><p>指定容器的用户，默认是root。</p></td>
</tr>
<tr class="row-even"><td><p>-e</p></td>
<td><p>指定环境变量，容器中可以使用该环境变量。</p></td>
</tr>
<tr class="row-odd"><td><p>-it</p></td>
<td><p>其中，-i表示以交互模式运行容器，-t表示为容器重新分配一
个输入终端，两者通常同时使用。“镜像名称”：docker镜像的名称；</p>
<p>“镜像Tag”：docker镜像的tag。</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="id17">
<h4><span class="section-number">2.2.4.3. </span>运行示例<a class="headerlink" href="#id17" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>docker run –name=knight_docker -v localhost_dir:/data -it ts.knight:
xxx /bin/bash</p>
</div></blockquote>
<p>容器启动成功后，在容器内任意目录下均可使用Knight命令，Knight帮助信息页面示例如下所示。</p>
<figure class="align-center">
<img alt="pipeline" src="../_images/image101.png" />
</figure>
</section>
</section>
<section id="id18">
<h3><span class="section-number">2.2.5. </span>库文件使用说明<a class="headerlink" href="#id18" title="Permalink to this heading"></a></h3>
<p>库文件包括TX510x-Lib，TX5368x_TX5339x_TX5335x
-Lib，TX5112x_TX5239x201-Lib，TX5215x_TX5239x200_ TX5239x220_TX5239x300
-Lib，TX5336x_TX5256x-Lib以及TX5110x-Lib使用详情参见《TS.Knight-SDK使用指南》。</p>
<p>Knight Finetune库使用详情参见《TS.Knight-Finetune-Lib使用指南》。</p>
</section>
</section>
<section id="id19">
<h2><span class="section-number">2.3. </span>支持芯片<a class="headerlink" href="#id19" title="Permalink to this heading"></a></h2>
<p>TS.Knight工具链支持清微芯片型号参见<a class="reference external" href="l">产品版本</a>。</p>
<p>当前默认芯片型号为TX5368AV200，如果使用其他系列芯片工具链，可使用–default-chip
修改默认芯片型号，或者在使用Knight命令行中配置-ch/–chip参数指定芯片型号。</p>
</section>
<section id="id20">
<h2><span class="section-number">2.4. </span>Knight使用方式<a class="headerlink" href="#id20" title="Permalink to this heading"></a></h2>
<section id="id21">
<h3><span class="section-number">2.4.1. </span>Knight命令介绍<a class="headerlink" href="#id21" title="Permalink to this heading"></a></h3>
<p>Knight作为工具链功能的总入口，支持以下参数：</p>
<ul class="simple">
<li><p>-v: 查看Knight工具链版本信息，界面显示如下所示。</p></li>
</ul>
<figure class="align-center">
<img alt="pipeline" src="../_images/image111.png" />
</figure>
<ul class="simple">
<li><p>-h: 查看帮助信息，界面显示参见<a class="reference external" href="l">2.4.3章节</a>。</p></li>
<li><p>-ch/–chip:
配置芯片型号，可调用相应型号下的工具链功能，可选命令参数，默认值为TX5368AV200。</p></li>
<li><p>–default-chip:
配置芯片型号-ch/–chip默认值，用户可通过以下命令行配置新的默认值。</p></li>
</ul>
<blockquote>
<div><p>Knight –default-chip TX5368AV200</p>
</div></blockquote>
<p>通过Knight命令并配置芯片型号-ch/–chip参数即可调用相应型号下的工具链功能。Knight命令行模板如下所示。</p>
<blockquote>
<div><p>Knight -ch/–chip [芯片型号] [子命令] …</p>
</div></blockquote>
<p>Knight 子命令对应工具链的功能，命令取值和对应含义如下表所示。</p>
<ul class="simple">
<li><p>Knight build ：-Knight量化编译工具，用来将浮点模型转换为tsmodel模型部署资源，并完成模型精度比对和模型正确性验证。</p></li>
<li><p>Knight quant ：Knight量化工具，详情参见《TS.Knight-量化使用指南》</p></li>
<li><p>Knight compile ：Knight RNE编译器，详情参见《TS.Knight-编译仿真性能分析使用指南》</p></li>
<li><p>Knight compare ： Knight精度比较工具，详情参见第<a class="reference external" href="l">6章节</a></p></li>
<li><p>Knight run ：Knight RNE模拟器，详情参见《TS.Knight-编译仿真性能分析使用指南》</p></li>
<li><p>Knight profiling ：Knight RNE性能分析器，详情参见《TS.Knight-编译仿真性能分析使用指南》</p></li>
</ul>
<p>通过指定–help,可查看各类子命令的参数信息，Knight
compile查看帮助信息界面示例如下。</p>
<figure class="align-center">
<img alt="pipeline" src="../_images/image121.png" />
</figure>
</section>
<section id="id22">
<h3><span class="section-number">2.4.2. </span>配置文件介绍<a class="headerlink" href="#id22" title="Permalink to this heading"></a></h3>
<p>TS.Knight工具链子命令行支持两种使用方式：一是配置文件的使用方式；二是命令行的使用方式。</p>
<p>命令行模板如下所示：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Knight<span class="w"> </span>build<span class="w"> </span>-rc/--run-config<span class="w"> </span>config.json
</pre></div>
</div>
<p>具体示例如下</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Knight<span class="w"> </span>build<span class="w"> </span>--run-config<span class="w"> </span>config.json
Knight<span class="w"> </span>quant<span class="w"> </span>--run-config<span class="w"> </span>config.json
Knight<span class="w"> </span>compile<span class="w"> </span>--run-config<span class="w"> </span>config.json
Knight<span class="w"> </span>run<span class="w"> </span>--run-config<span class="w"> </span>config.json
Knight<span class="w"> </span>profiling<span class="w"> </span>--run-config<span class="w"> </span>config.json
</pre></div>
</div>
<p>在json配置文件中可定义”quant”, ” compile”, ”run”, ”profiling”
字段，不要求包含所有的字段，根据需要执行的流程进行配置即可。</p>
<p>执行Knight build 需要定义”quant”, ” compile”字段，示例如下:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>{
&quot;chip&quot;: TX5336AV200,
&quot;quant&quot;: {
&quot;model&quot;: &quot;resnet18.onnx&quot;,
&quot;infer-func&quot;: &quot; infer_resnet18&quot;,
&quot;run-mode&quot;: “quant”,
&quot;output-dequant&quot;: false,
&quot;dump&quot;: true,
&quot;save-dir&quot;: &quot;output&quot;,
&quot;user-defined-script&quot;: &quot;model_define.py&quot;,
input-configs:[
{
&quot;input_name&quot;: &quot;input1&quot;,
&quot;data_dir&quot;: &quot;path/to/img_data&quot;,
&quot;color_space&quot;: “BGR”,
&quot;mean&quot;: [0, 0, 0],
&quot;std&quot;: [255.0, 255.0, 255.0]
}]
&quot;compile&quot;: {
&quot;onnx&quot;: &quot;output/resnet18_quantized.onnx&quot;,
&quot;save-dir&quot;: &quot;output/&quot;
}
}
</pre></div>
</div>
<p>当执行如下命令时，则仅读取”quant”字段信息，并执行量化操作。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Knight<span class="w"> </span>quant<span class="w"> </span>--run-config<span class="w"> </span>config.json
</pre></div>
</div>
<p>当同时指定config配置文件和命令行参数时，则命令行参数生效，优先级高于配置文件，示例如下。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Knight<span class="w"> </span>quant<span class="w"> </span>--run-config<span class="w"> </span>config.json<span class="w"> </span>--bit-width<span class="w"> </span><span class="m">16</span>
</pre></div>
</div>
<p>当执行Knight build则连续执行量化”quant”和 编译”
compile”两个步骤，此时若需要同时使用命令行，则需要增加quant或compile前缀，示例如下。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Knight<span class="w"> </span>build<span class="w"> </span>--run-config<span class="w"> </span>config.json<span class="w"> </span>--quant.bit-width<span class="w"> </span><span class="m">16</span>
--compile.save-dir<span class="w"> </span>“/tmp”
</pre></div>
</div>
</section>
</section>
<section id="knight-compare">
<h2><span class="section-number">2.5. </span>Knight compare工具<a class="headerlink" href="#knight-compare" title="Permalink to this heading"></a></h2>
<p>为了方便定位产生精度问题的算子，我们可以通过对比浮点-量化算子或者量化-模拟器算子的输出。</p>
<p>Compare工具给出了两种精度指标，MRE和余弦相似度。此外还提供了均方根误差（rmse）,最大单点误差（maxdiff），有偏性（bias），参考如下：</p>
<p><strong>简称</strong> <strong>名称</strong>            <strong>说明</strong>
mre      平均相对误差        数值越大，误差越大
cos      余弦相似度          数值越小，误差越大
rmse     均方根误差          数值越大，误差越大
maxdiff  单点最大误差(m1/m2) 数值越大，误差越大
bias     有偏性（b1,b2)      第一个数据大，表示数据偏向右边。第二个数据大，表示数据偏向左边。
======== ===================
================================================================</p>
<p>Compare工具使用前，需要完成模型转换和模拟器推理，Compare工具支持量化前后精度比对（量化-浮点），定点模型推理结果和模拟推理结果数据比对（量化-模拟器），以及模拟器推理结果和模拟库推理结果比对（模拟器-模拟库）三种数据比较方式。</p>
<section id="id23">
<h3><span class="section-number">2.5.1. </span>参数说明<a class="headerlink" href="#id23" title="Permalink to this heading"></a></h3>
</section>
<section id="id24">
<h3><span class="section-number">2.5.2. </span>使用示例<a class="headerlink" href="#id24" title="Permalink to this heading"></a></h3>
<p>示例一：量化-浮点精度对比</p>
<p>步骤一：量化(需要指定dump 为true)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Knight<span class="w"> </span>build<span class="w"> </span>-rc<span class="w"> </span>/TS-KnightDemo/Samples/resnet18_config.json
</pre></div>
</div>
<p>步骤二：使用Knight compare逐层数据比对</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Knight<span class="w"> </span>--chip<span class="w"> </span>TX5368AV200<span class="w"> </span>compare<span class="w"> </span>-qd<span class="w"> </span>/TS-KnightDemo/output/resnet18/quant
</pre></div>
</div>
<p>示例二：量化-模拟器数据对比</p>
<p>步骤一：量化模型</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Knight<span class="w"> </span>build<span class="w"> </span>-rc<span class="w"> </span>/TS-KnightDemo/Samples/resnet18_config.json
</pre></div>
</div>
<p>命令运行完毕后，会保存如下文件，作为模拟器的输入。
/output/resnet18/quant/inputs/x.bin</p>
<p>步骤二：仿真模型</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Knight<span class="w"> </span>run<span class="w"> </span>--model<span class="w"> </span>/TS-KnightDemo/output/resnet18/rne/resnet18_quantize_r.tsmodel<span class="w"> </span><span class="se">\</span>
--input<span class="w"> </span>/TS-KnightDemo/output/resnet18/quant/inputs/x.bin<span class="w"> </span><span class="se">\</span>
--format<span class="w"> </span>nchw<span class="w"> </span><span class="se">\</span>
--save-dir<span class="w"> </span>/TS-KnightDemo/output/resnet18/rne
</pre></div>
</div>
<p>步骤三：量化-模拟器数据比较</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>knight<span class="w"> </span>compare<span class="w"> </span>-qd<span class="w"> </span>/TS-KnightDemo/output/resnet18/quant<span class="w"> </span>-sd<span class="w"> </span>/TS-KnightDemo/output/resnet18/rne
</pre></div>
</div>
<p>示例三：两个模拟器输出结果对比</p>
<p>数据准备参考上一节的模拟器数据准备。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Knight<span class="w"> </span>compare<span class="w"> </span>-sd<span class="w"> </span>/TS-KnightDemo/output/resnet18/rne**:**/output/resnet18/rne
</pre></div>
</div>
<p>示例四：详细数据比较</p>
<p>示例五：按照指定精度字段排序</p>
<p>Knight compare -qd /TS-KnightDemo/output/resnet18/quant/ <strong>–no-cos –no-mre –rmse –maxdiff –sort rmse</strong></p>
<p>示例六：保存比较结果</p>
<p>将所有算子的量化-浮点比较直方图输出到tmp/result目录中</p>
<p>保存折线图命令</p>
<p>保存的文件如下</p>
<figure class="align-center">
<img alt="pipeline" src="../_images/image131.png" />
</figure>
<p>其中折线图为plot_result.png, plot_out_name_idx.txt保存了折线图里output
index和output name的映射关系。</p>
<p>示例七：选择要比较的算子类型</p>
<p>示例八：直方图比较</p>
<p>要显示直方图，需要完成以下环境配置</p>
<ol class="loweralpha simple">
<li><p>在宿主机开放权限，允许所有用户访问X11 的显示接口：</p></li>
</ol>
<p>如果没有安装X11，请执行如下命令:
.. code-block:: bash</p>
<blockquote>
<div><p>sudo apt-get install x11-xserver-utils</p>
</div></blockquote>
<p>如果$HOME目录下没有.Xauthority文件，创建空文件touch .Xauthority并执行：
.. code-block:: bash</p>
<blockquote>
<div><p>xhost +</p>
</div></blockquote>
<p>在宿主机每一次开机时执行xhost +</p>
<ol class="loweralpha simple" start="2">
<li><p>在启动容器时，必须使用root用户权限，同时需额外添加以下命令：</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-u<span class="w"> </span>root
-e<span class="w"> </span><span class="nv">DISPLAY</span><span class="o">=</span><span class="nv">$DISPLAY</span>
-v<span class="w"> </span>/tmp/.X11-unix:/tmp/.X11-unix:rw
-v<span class="w"> </span><span class="nv">$HOME</span>/.Xauthority:/root/.Xauthority
--net<span class="w"> </span>host
</pre></div>
</div>
<ol class="loweralpha simple" start="3">
<li><p>运行示例</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>-v<span class="w"> </span>localhost_dir:container_dir<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>--net<span class="w"> </span>host<span class="w"> </span>-e
<span class="nv">DISPLAY</span><span class="o">=</span><span class="nv">$DISPLAY</span><span class="w"> </span>-v<span class="w"> </span>/tmp/.X11-unix:/tmp/.X11-unix:rw<span class="w"> </span>-v
<span class="nv">$HOME</span>/.Xauthority:/root/.Xauthority<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>-it<span class="w"> </span>ts.knight:xxx
/bin/bash
</pre></div>
</div>
<p>执行以下Knight compare命令：</p>
<figure class="align-center">
<img alt="pipeline" src="../_images/image14.png" />
</figure>
<p>输出示例如上图所示，左上为浮点算子输出的直方图，左下为浮点算子的权重直方图。右上为量化算子输出的直方图，
右下为量化算子的权重直方图。</p>
<p>显示折线图示例如下：</p>
<figure class="align-center">
<img alt="pipeline" src="../_images/image14.png" />
</figure>
</section>
</section>
<section id="id25">
<h2><span class="section-number">2.6. </span>小工具介绍<a class="headerlink" href="#id25" title="Permalink to this heading"></a></h2>
<section id="show-sim-result">
<h3><span class="section-number">2.6.1. </span>show_sim_result工具<a class="headerlink" href="#show-sim-result" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>show_sim_result用来显示模拟器输出文件里的数据，同时支持将模拟器的输出数据保存到*.npy文件中。</p>
</div></blockquote>
<section id="id26">
<span id="id27"></span><h4><span class="section-number">2.6.1.1. </span>参数说明<a class="headerlink" href="#id26" title="Permalink to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数名称</p></th>
<th class="head"><p>必需/可选</p></th>
<th class="head"><p>默认值</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-sd或</p>
<p>–sim-data</p>
</td>
<td><p>必选</p></td>
<td><p>无</p></td>
<td><p>指定模拟器输
出文件或者模拟器数据的保存路径。</p>
<p>如果指
定的是目录，则会将此目录下的模拟
器输出的*_p.txt文件转化为*.npy文
件并保存到—save-dir指定的目录下。</p>
<p>注：此目录下的*_hwc_p.txt文
件因为和*_p.txt文件的数据完全相同
，只是数据排布不同，因此只会在没
有对应的*_p.txt文件的情况下转换。</p>
</td>
</tr>
<tr class="row-odd"><td><p>–save-dir</p></td>
<td><p>可选</p></td>
<td><p>无</p></td>
<td><p>指定*.npy文件的保存路径。</p>
<p>如果—sim-data指定的
是路径，<strong>则此选项为必选</strong>。</p>
<p>如果—sim-data指定的是文
件，则此选项非必选。无此选项时会
在终端上输出文件的数据，有此选项
时会将文件内容保存为*.npy文件。</p>
<p><strong>输出文件名格式</strong>：
文件主名和输
入文件名一致，扩展名改为*.npy。</p>
</td>
</tr>
<tr class="row-even"><td><p>-i或</p>
<p>–index</p>
</td>
<td><p>可选</p></td>
<td><p>无</p></td>
<td><p>在显示数据
时，指定要显示的数据的索引范围。</p>
<p>–index所指定
的索引个数&lt;=数据维度个数。第一个
索引范围对应数据第0维度，第二个索
引范围对应数据第1维度，以此类推。</p>
<p><strong>格
式：</strong>逗号分隔，索引范围列表。</p>
<p><strong>索引范围格式</strong>:</p>
<p>1.
&lt;
n&gt;，一个数字，表示某维度第n组数据</p>
<p>2.&lt;start&gt;-&lt;end&gt;，表示[start, end]</p>
<p>3.&lt;start&gt;-，一个数字带一
个减号，表示[start,&lt;该轴的最大值
&gt;]。例如，数据形状[1,3,224,224],
则–index
0,1,2,3-表
示的数据索引范围为[0,1,2,3:223]。</p>
<p><strong>缺省：</strong>显示全部数据。</p>
<p><strong>注：</strong>此选项只
适用于–sim-data指定文件的时候。</p>
</td>
</tr>
<tr class="row-odd"><td><p>-fmt或</p>
<p>–format</p>
</td>
<td><p>可选</p></td>
<td><p>nchw</p></td>
<td><p>指定输出数据的维度排列格式</p>
<p>支持两种格式：</p>
<ol class="arabic simple">
<li><p>nhwc</p></li>
<li><p>nchw</p></li>
</ol>
</td>
</tr>
<tr class="row-even"><td><p>-h或–help</p></td>
<td><p>可选</p></td>
<td><p>无</p></td>
<td><p>显示帮助信息。</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id28">
<span id="id29"></span><h4><span class="section-number">2.6.1.2. </span>使用示例<a class="headerlink" href="#id28" title="Permalink to this heading"></a></h4>
<p>示例一:显示文件内容</p>
<p>示例二：指定索引范围</p>
<p>示例三：转换所有模拟器结果为*.npy文件</p>
</section>
</section>
<section id="model-modifier">
<h3><span class="section-number">2.6.2. </span>model_modifier工具<a class="headerlink" href="#model-modifier" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>model_modifier用来裁剪onnx模型。</p>
</div></blockquote>
<section id="id30">
<span id="id31"></span><h4><span class="section-number">2.6.2.1. </span>参数说明<a class="headerlink" href="#id30" title="Permalink to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数名称</p></th>
<th class="head"><p>必需/可选</p></th>
<th class="head"><p>默认值</p></th>
<th class="head"><p>说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-sd或</p>
<p>–sim-data</p>
</td>
<td><p>必选</p></td>
<td><p>无</p></td>
<td><p>指定模拟器输
出文件或者模拟器数据的保存路径。</p>
<p>如果指
定的是目录，则会将此目录下的模拟
器输出的*_p.txt文件转化为*.npy文
件并保存到—save-dir指定的目录下。</p>
<p>注：此目录下的*_hwc_p.txt文
件因为和*_p.txt文件的数据完全相同
，只是数据排布不同，因此只会在没
有对应的*_p.txt文件的情况下转换。</p>
</td>
</tr>
<tr class="row-odd"><td><p>–save-dir</p></td>
<td><p>可选</p></td>
<td><p>无</p></td>
<td><p>指定*.npy文件的保存路径。</p>
<p>如果—sim-data指定的
是路径，<strong>则此选项为必选</strong>。</p>
<p>如果—sim-data指定的是文
件，则此选项非必选。无此选项时会
在终端上输出文件的数据，有此选项
时会将文件内容保存为*.npy文件。</p>
<p><strong>输出文件名格式</strong>：
文件主名和输
入文件名一致，扩展名改为*.npy。</p>
</td>
</tr>
<tr class="row-even"><td><p>-i或</p>
<p>–index</p>
</td>
<td><p>可选</p></td>
<td><p>无</p></td>
<td><p>在显示数据
时，指定要显示的数据的索引范围。</p>
<p>–index所指定
的索引个数&lt;=数据维度个数。第一个
索引范围对应数据第0维度，第二个索
引范围对应数据第1维度，以此类推。</p>
<p><strong>格
式：</strong>逗号分隔，索引范围列表。</p>
<p><strong>索引范围格式</strong>:</p>
<p>1.
&lt;
n&gt;，一个数字，表示某维度第n组数据</p>
<p>2.&lt;start&gt;-&lt;end&gt;，表示[start, end]</p>
<p>3.&lt;start&gt;-，一个数字带一
个减号，表示[start,&lt;该轴的最大值
&gt;]。例如，数据形状[1,3,224,224],
则–index
0,1,2,3-表
示的数据索引范围为[0,1,2,3:223]。</p>
<p><strong>缺省：</strong>显示全部数据。</p>
<p><strong>注：</strong>此选项只
适用于–sim-data指定文件的时候。</p>
</td>
</tr>
<tr class="row-odd"><td><p>-fmt或</p>
<p>–format</p>
</td>
<td><p>可选</p></td>
<td><p>nchw</p></td>
<td><p>指定输出数据的维度排列格式</p>
<p>支持两种格式：</p>
<ol class="arabic simple">
<li><p>nhwc</p></li>
<li><p>nchw</p></li>
</ol>
</td>
</tr>
<tr class="row-even"><td><p>-h或–help</p></td>
<td><p>可选</p></td>
<td><p>无</p></td>
<td><p>显示帮助信息。</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id32">
<span id="id33"></span><h4><span class="section-number">2.6.2.2. </span>使用示例<a class="headerlink" href="#id32" title="Permalink to this heading"></a></h4>
<p>model_modifier –model /TS-KnightDemo/Samples/resnet18/models/onnx_model/resnet18.onnx</p>
<p>–submodel-name reset18_bn1_layer1_1_relu_1 –input-names bn1 –output-names layer1_1_relu_1 –save-dir ./</p>
</section>
</section>
<section id="model-info">
<h3><span class="section-number">2.6.3. </span>model_info工具<a class="headerlink" href="#model-info" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>model_info工具用来显示量化后的ONNX模型的量化参数信息以及输出层反量化系数。</p>
</div></blockquote>
<section id="id34">
<span id="id35"></span><h4><span class="section-number">2.6.3.1. </span>参数说明<a class="headerlink" href="#id34" title="Permalink to this heading"></a></h4>
<p><a href="#id49"><span class="problematic" id="id50">|-m或--model         | 必选    | 无    | 待显示的模型路径，仅支持ONNX格式         |
+--------------------+---------+-------+-----------------------------------+
|-ds或--dequant-scale|</span></a> 可选    | 无    <a href="#id36"><span class="problematic" id="id37">|</span></a>若设置，显示量化后模型的输出层及对应的反量化系数。    |</p>
<p><strong>参数名称</strong>    <strong>必选/可选</strong> <strong>默认值</strong> <strong>说明</strong>
-m或            必选          无         待显示的模型路径，仅支持ONNX格式</p>
<p>–model
-ds或           可选          无         若设置，显示量化后模型的输出层及对应的反量化系数。</p>
<p>–dequant-scale
-qi或           可选          无         若设置，显示量化后模型的量化配置信息。</p>
<p>–quant-info
-h或–help      可选          无         显示帮助信息。
=============== ============= ==========</p>
</section>
<section id="id38">
<span id="id39"></span><h4><span class="section-number">2.6.3.2. </span>使用示例<a class="headerlink" href="#id38" title="Permalink to this heading"></a></h4>
<figure class="align-center">
<img alt="pipeline" src="../_images/image15.png" />
</figure>
</section>
</section>
<section id="model-check-py">
<h3><span class="section-number">2.6.4. </span>model_check.py工具<a class="headerlink" href="#model-check-py" title="Permalink to this heading"></a></h3>
<p>用户执行完量化命令和编译命令后，可使用该脚本进行检查点2，检查点3（参见<a class="reference external" href="l">章节1.3.2</a>）结果验证。</p>
<p>容器内<em>/TS-Knight-software/tools/model_check/model_check.py</em>参数说明如下表所示：</p>
<section id="id40">
<span id="id41"></span><h4><span class="section-number">2.6.4.1. </span>参数说明<a class="headerlink" href="#id40" title="Permalink to this heading"></a></h4>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>参数名称</p></th>
<th class="head"><p>必选/
可选</p></th>
<th class="head"><p>默认值</p></th>
<th class="head"><p>参数说明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-h/–help</p></td>
<td><p>可
选</p></td>
<td><p>无</p></td>
<td><p>查看帮助信息</p></td>
</tr>
<tr class="row-odd"><td><p>-qo/–quant-output</p></td>
<td><p>必选</p></td>
<td><p>无</p></td>
<td><p>执行量化命令时后模型保存目录。
ONNX 量化命令需要指定参数–dump,
此时
–quant-output需指定为{–save_dir}
/dump，或者拷贝该路径内文件到其他路
径时，也可指定相应的路径，需要保证d
ump并列的目录下有量化后的onnx模型；</p></td>
</tr>
<tr class="row-even"><td><p>-co/–compile-output</p></td>
<td><p>必
选</p></td>
<td><p>无</p></td>
<td><p>执行编译命令时结果保存目录</p></td>
</tr>
<tr class="row-odd"><td><p>-fmt/–format</p></td>
<td><p>可
选</p></td>
<td><p>自动根据量
化输入数据
类型判断</p></td>
<td><p>输入数据format, 取值范围</p>
<p>[“nchw”,”nhwc”]</p>
</td>
</tr>
<tr class="row-even"><td><p>-r/–run-mode</p></td>
<td><p>可
选</p></td>
<td><p>0</p></td>
<td><p>取值范围[0,1]</p>
<p>0:
表示仅对比
量化后结果和模拟器结果（检查点1）；</p>
<p>1:
表示对比量化
后结果和模拟器结果（检查点1），以及
模拟器结果和模拟库结果（检查点2）。</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="id42">
<span id="id43"></span><h4><span class="section-number">2.6.4.2. </span>使用示例<a class="headerlink" href="#id42" title="Permalink to this heading"></a></h4>
<p>步骤一：完成量化编译
.. code-block:: bash</p>
<blockquote>
<div><p>Knight build -rc /TS-KnightDemo/Samples/configs/resnet18_build_config.json</p>
</div></blockquote>
<p>步骤二：验证模型正确性</p>
</section>
</section>
</section>
<section id="id44">
<h2><span class="section-number">2.7. </span>算子介绍<a class="headerlink" href="#id44" title="Permalink to this heading"></a></h2>
<p>Knight工具链中支持的算子有2类：</p>
<p>高效算子：运行在RNE硬件单元上，执行效率高；</p>
<p>通用算子：运行在CPU等通用计算硬件单元上，执行效率相比于高效算子低，用户模型中经常使用且</p>
<p>RNE硬件单元不支持，Knight工具链出厂时已支持；</p>
<p>各芯片支持的高效算子、通用算子请参见相应芯片的《TS.Knight-xxx-RNE编译器算子规格表》和《TS.Knight-xxx量化算子规格表》。</p>
</section>
<section id="faq">
<h2><span class="section-number">2.8. </span>FAQ<a class="headerlink" href="#faq" title="Permalink to this heading"></a></h2>
<section id="id45">
<h3><span class="section-number">2.8.1. </span>退出docker容器后恢复工作环境<a class="headerlink" href="#id45" title="Permalink to this heading"></a></h3>
<p>【问题描述】</p>
<p>退出docker容器后如何恢复工作环境?</p>
<p>【解决方法】</p>
<blockquote>
<div><p>可重启容器，然后进入容器以恢复工作环境。</p>
</div></blockquote>
</section>
<section id="knight-chip">
<h3><span class="section-number">2.8.2. </span>Knight命令行重复输入–chip<a class="headerlink" href="#knight-chip" title="Permalink to this heading"></a></h3>
<div class="line-block">
<div class="line">【问题描述】</div>
<div class="line">Knight命令行重复输入-ch/–chip时，哪个生效？</div>
</div>
<p>【解决方法】</p>
<p>当输入两次及以上的-ch/–chip参数时，第一次配置的芯片型号生效，示例如下。</p>
</section>
<section id="id46">
<h3><span class="section-number">2.8.3. </span>docker权限问题<a class="headerlink" href="#id46" title="Permalink to this heading"></a></h3>
<p>【问题描述】</p>
<p>如果出现“Got permission denied while trying to connect to the Docker
daemon socket at unix:///var/run/docker.sock”</p>
<p>【解决方法】</p>
<p>可能是因为用户没有权限启动docker服务，请联系管理员开通权限。</p>
</section>
<section id="knightroot">
<h3><span class="section-number">2.8.4. </span>Knight容器能否使用非root权限启动<a class="headerlink" href="#knightroot" title="Permalink to this heading"></a></h3>
<p>【问题描述】</p>
<p>Knight容器能否使用非root权限启动？</p>
<p>【解决方法】</p>
<p>Knight容器默认使用root用户启动，同样可以支持使用非root权限启动，启动命令如下：
.. code-block:: bash</p>
<blockquote>
<div><p>docker run -it -u ${uid} ts.knight:xxx /bin/bash</p>
</div></blockquote>
</section>
<section id="id47">
<h3><span class="section-number">2.8.5. </span>Knight镜像如何增量更新<a class="headerlink" href="#id47" title="Permalink to this heading"></a></h3>
<p>【问题描述】</p>
<p>由于Knight镜像中包含多个模块，若仅有一个模块进行了更新修改，如何增量更新Knight镜像？</p>
<p>【解决方法】</p>
<ol class="arabic simple">
<li><p>首先启动Knight容器：</p></li>
</ol>
<blockquote>
<div><p>docker run –name=knight_docker -it ts.knight:xxx /bin/bash</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>将需要更新的模块文件在宿主机上的目录${host_module_file}拷贝到Knight容器中相应目录${docker_module_dir}下，命令示例如下：</p></li>
</ol>
<blockquote>
<div><p>docker cp ${ host_module_dir} 容器ID: ${docker_module_dir}</p>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>将容器保存为新镜像，命令示例如下：</p></li>
</ol>
<blockquote>
<div><p>docker commit 容器ID ts.knight-new:xxx</p>
</div></blockquote>
</section>
</section>
<section id="id48">
<h2><span class="section-number">2.9. </span>附录<a class="headerlink" href="#id48" title="Permalink to this heading"></a></h2>
<p>json配置文件</p>
<p>如下是包含”quant”和”compile”字段的json配置文件示例参考，详细信息请参考《TS.Knight-量化使用指南》和《TS.Knight-编译仿真性能分析使用指南》。</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>{
//可选，默认和--default-chip一致(默认为TX5368AV200)
&quot;chip&quot;: &lt;芯片型号&gt;,
//可选，类型：bool，默认false,表示开启量化精度比对
&quot;disable-compare&quot;: false,
//可选，类型：bool，默认false,表示开启模型正确性验证
&quot;disable-model-check&quot;:false,
&quot;quant&quot;: {
// 待量化模型所属框架类型。类型：string，可选，默认&quot;onnx&quot;,
取值范围[onnx, pytorch, caffe,paddle, tensorflow]
&quot;framework&quot;: &quot;onnx&quot;,
// 指定模型文件，若为ONNX格式则指ONNX模型文件。类型：string，必选
&quot;model&quot;: &quot;resnet18.onnx&quot;,
// 模型权重文件，类型：string，可选，默认None
&quot;weight&quot;: None,
// 前向推理函数名称。类型：string，可选，默认&quot;infer_auto&quot;
&quot;infer-func&quot;: &quot;infer_auto&quot;,
//量化输入数据路径，类型：string，可选
&quot;data&quot;: &quot;path/data_dir&quot;,
//量化位宽，类型：int，可选，默认8，取值范围[8, 16]
&quot;bit-width&quot;: 8,
//量化时模型执行推理次数，类型：int，可选，默认1

&quot;iteration&quot;: 200,

//量化模型时加载量化数据的batchsize大小。类型：int，可选，默认1

&quot;batch-size&quot;: 16,

//设置量化后模型的batchsize。类型：int，可选，默认1

&quot;ir-batch&quot;: 1,

//日志级别。类型：int，可选，默认3

&quot;log-level&quot;: 3,

//计算激活系数方式。类型：string，可选，默认kl

&quot;quant-mode&quot;: “kl” ,

//仅在quant-mode设置为percentile时生效，设定量化百分位。类型：string，可选，默认0.99999

&quot;percent&quot;: 0.99999,

//量化模式。类型：string，可选，默认quant，可选范围[“quant”,”infer”,”convert”,”compare”,”auto_quant”]

&quot;run-mode&quot;: “quant”,

//指定量化后模式输入数据类型。类型：string，可选，默认None

&quot;quantize-input-dtype&quot;: None,

//存放量化scale信息的json文件路径。类型：string，可选，默认None

&quot;load-scale-json&quot;: None,

//是否增加反量化。类型：bool，可选， 默认false

&quot;output-dequant&quot;: false,

//指定Tensorflow模型量化开始节点名。类型：string，可选，默认None

&quot;start-node-names&quot;: None,

//指定Tensorflow模型量化结束节点名。类型：string，可选，默认None

&quot;end-node-names&quot;: None,

//仅量化Tensorflow模型时使用，指定后当输入format为4维NHWC，转出的onnx模型从输入开始的format都为NCHW。类型：bool，可选，默认false

&quot;convert2chw&quot;: false,

//输入数据shape,仅针对Paddle模型。类型：list，可选，默认None

&quot;input-shapes&quot;: None,

//指定量化后模型保存路径。类型：string，可选，默认&quot;/TS-KnightOutput/QuantOnnx/&quot;

&quot;save-dir&quot;: &quot;/TS-KnightOutput/QuantOnnx/&quot;,

//设置生成模型对应的混合量化模板json配置文件。类型：string，可选，默认None

&quot;generate-template&quot;:None,

//混合量化json文件路径。类型：string，可选，缺省None

&quot;mix-config&quot;: None,

//指定输入后需要增加的BN算子的方差。类型：string，可选，缺省None

&quot;std&quot;: 0, 0, 0,

//指定输入后需要增加的BN算子的均值。类型：string，可选，缺省None

&quot;mean&quot;: 255.0, 255.0, 255.0,

//指定用户自定义的python脚本，用于加载推理函数、加载pytorch模型定义。类型：string，可选，缺省None

&quot;user-defined-script&quot;: “path/model_define.py”,

//量化并行cpu数。类型：int，可选，默认5

&quot;cpu-num&quot;: 5,

//scale统计直方图缓存文件路径，设置该参数，则会加载缓存文件，跳过scale计算前向推理过程。类型：string，可选，默认None

&quot;cache-distribution&quot;: None,

//是否对Concat，Stack和ScatterND类型的算子进行系数统一。类型：bool，可选，缺省false

&quot;unify-input-scale&quot;: false,

//设置lut表格长度。类型：int，可选，默认10, 取值范围[8, 9, 10, 11,
12]

&quot;lut-len&quot;: 10,

//生成混合量化模板时使用。类型：float，可选，默认0.5

&quot;auto-mix-ratio&quot;:0.5,

//指定混合量化模板生成策略。类型：string，可选，默认
initial，取值范围[&#39;HAWQ&#39;, &#39;IOhigh&#39;, &#39;initial&#39;]

&quot;auto-mix-strategy&quot;: “initial”,

//数据预处理

&quot;input-configs&quot;:[

{

// onnx模型输入名称，必选

&quot;input_name&quot;: &quot;input&quot;,

// 输数据类型，必选，取值范围[Image,Numpy],

&quot;quant_data_format&quot;: &quot;Image&quot;,

// 输入图像的路径，必选

&quot;data_dir&quot;: &quot;path/to/img_data&quot;,

// onnx模型需要的图像格式，取值范围[BGR,RGB]，可选，默认BGR,

&quot;color_space&quot;: &quot;BGR&quot;,

// 均值，可选，quant_data_format为Image时需要配置

&quot;mean&quot;: [0, 0, 0],

// 方差，可选，quant_data_format为Image时需要配置

&quot;std&quot;: [255.0, 255.0, 255.0],

}]

}

&quot;compile&quot;: {

// onnx神经网络模型文件路径。类型：string，可选

&quot;onnx&quot;: &quot;path&quot;,

// 保存路径。类型：string，可选，默认&quot;onnx&quot;

&quot;save-dir&quot;: &quot;path&quot;,

// 日志级别。类型：int，取值范围[0,1,2,3]，可选，默认3

&quot;log-level&quot;: &quot;3&quot;,

// 指示是否对ddr做优化。类型：int，取值范围[0,1,2]，可选，默认1

&quot;opt-ddr&quot;: &quot;1&quot;,

//设置该参数时，打开input blobs mem是否独立于blobs mem的开关
指示是否对ddr做优化。类型：bool,可选，默认false

&quot;input-indep&quot;: &quot;0&quot;,

//此参数控制用户可使用的硬件资源大小, 取值范围[&quot;little&quot;,&quot;middle&quot;,
&quot;big&quot;, &quot;super&quot;]，可选，默认&quot;super&quot;

&quot;hardware-resource-mode&quot;: &quot;super&quot;

}}
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../doc_info/doc_info.html" class="btn btn-neutral float-left" title="1. 修改记录" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../quick_demo/quick_demo.html" class="btn btn-neutral float-right" title="3. 快速上手指南" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright COPYRIGHT© 2024北京清微智能科技有限公司, 保留所有权利。.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>